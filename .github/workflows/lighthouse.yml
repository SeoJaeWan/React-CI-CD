name: Lighthouse CI

on:
  pull_request_target:
    branches: [develop]

jobs:
  lhci:
    name: "Lighthouse Test"
    runs-on: "ubuntu-latest"

    strategy:
      matrix:
        node-version: ["18.x"]

    steps:
      - name: "Check for GitHub Token"
        run: |
          if [ -z "${{ secrets.ACTION_TOKEN }}" ]; then
            echo "GitHub token is missing"
            exit 1
          else
            echo "GitHub token is present"
          fi

      - name: Checkout PR
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.ref }}
          repository: ${{ github.event.pull_request.head.repo.full_name }}

      - name: Use Node.js ${{ matrix.node-version }} & Caching
        uses: actions/setup-node@v4
        with:
          node-version: ${{matrix.node-version}}
          cache: "yarn"

      - name: Install dependencies
        run: yarn install --frozen-lockfile

      - name: Install missing babel plugin
        run: yarn add @babel/plugin-proposal-private-property-in-object --dev --frozen-lockfile

      - name: Install Lighthouse CLI
        run: yarn global add @lhci/cli --frozen-lockfile

      - name: Install Spreadsheet
        run: yarn add google-spreadsheet google-auth-library --frozen-lockfile

      - name: Run Build
        run:
          yarn build

          # Desktop ì„¤ì •ìœ¼ë¡œ Lighthouse ì¸¡ì •
      - name: Run Lighthouse CI for Desktop
        # secretsì— ì €ì¥í•œ LHCI_GITHUB_APP_TOKEN ê°’ ì‚¬ìš©
        env:
          LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}

        # Lighthouse CIë¥¼ ì „ì—­ìœ¼ë¡œ ì„¤ì¹˜
        # lighthouserc-desktop.js ì„¤ì • íŒŒì¼ì— ë”°ë¼ Lighthouse ë°ì´í„° ìˆ˜ì§‘
        # lighthouserc-desktop.js ì„¤ì • íŒŒì¼ì— ë”°ë¼ ìˆ˜ì§‘ëœ ë°ì´í„° ì—…ë¡œë“œ
        # ì‹¤íŒ¨ ì‹œ 'Fail to Run Lighthouse CI ğŸ’¦' ì¶œë ¥
        run: |
          lhci collect --config=lighthouserc-desktop.js || echo 'Fail to Run Lighthouse CI ğŸ’¦'
          lhci upload --config=lighthouserc-desktop.js || echo 'Fail to Run Lighthouse CI ğŸ’¦'

      # Mobile ì„¤ì •ìœ¼ë¡œ Lighthouse ì¸¡ì •
      - name: Run Lighthouse CI for Mobile
        env:
          LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}

        # lighthouserc-mobile.js ì„¤ì • íŒŒì¼ì— ë”°ë¼ Lighthouse ë°ì´í„° ìˆ˜ì§‘
        # lighthouserc-mobile.js ì„¤ì • íŒŒì¼ì— ë”°ë¼ ìˆ˜ì§‘ëœ ë°ì´í„° ì—…ë¡œë“œ
        # ì‹¤íŒ¨ ì‹œ 'Fail to Run Lighthouse CI ğŸ’¦' ì¶œë ¥
        run: |
          lhci collect --config=lighthouserc-mobile.js || echo 'Fail to Run Lighthouse CI ğŸ’¦'
          lhci upload --config=lighthouserc-mobile.js || echo 'Fail to Run Lighthouse CI ğŸ’¦'

        # Lighthouse ê²°ê³¼ë¥¼ PR Commentì— ì‘ì„±í•  í˜•ì‹ëŒ€ë¡œ í¬ë§·íŒ…
      - name: Format lighthouse score
        id: format_lighthouse_score
        uses: actions/github-script@v7
        with:
          script: |
            // Lighthouse ì¸¡ì • ê²°ê³¼ íŒŒì¼ì„ ì½ì–´ì˜¤ê¸° ìœ„í•´ 'fs' import
            const fs = require('fs');
            const { getLhciPageNameFromUrl, LHCI_GREEN_MIN_SCORE, LHCI_ORANGE_MIN_SCORE, LHCI_RED_MIN_SCORE } = require('./src/configs/lighthouse/constant.js');

            // ì ìˆ˜ë¥¼ ë°›ì•„ì„œ í•´ë‹¹ ì ìˆ˜ì˜ ìƒ‰ìƒì„ ë¦¬í„´í•´ì£¼ëŠ” í•¨ìˆ˜
            const getColor = (score) => {
              if (score >= LHCI_GREEN_MIN_SCORE) return 'ğŸŸ¢';
              else if (score >= LHCI_ORANGE_MIN_SCORE) return 'ğŸŸ ';
              return 'ğŸ”´';
            }

            // ì ìˆ˜ë¥¼ ë°›ì•„ì„œ ìƒ‰ìƒ + ì ìˆ˜ë¥¼ ë¦¬í„´í•´ì£¼ëŠ” í•¨ìˆ˜ë“¤
            // Performance, Accessibility, Best Practices, SEO, PWAì— ì ìš©ë¨
            const getAuditColorAndScore = (score) => getColor(score) + score;

            // Performance í•˜ìœ„ ì§€í‘œì¸ FCP, LCP, Speed Index, TBT, CLSì— ì ìš©ë¨
            const getPerformanceMetricColorAndScore = (category) => getColor(category.score * 100) + category.displayValue;

            // ì ìˆ˜ëŠ” 0-1ì˜ ìˆ«ìë¡œ í‘œí˜„ë˜ê¸° ë•Œë¬¸ì— 100ì„ ê³±í•´ì£¼ëŠ” í•¨ìˆ˜ í•„ìš”
            const formatResult = (res) => Math.round(res * 100);

            // Lighthouse ê²°ê³¼ê°€ ì €ì¥ëœ íŒŒì¼ì—ì„œ ë‚´ìš©ì„ ì½ì–´ì˜´
            // pathëŠ” '{Github Actions ëŸ¬ë„ˆì˜ ê¸°ë³¸ ë””ë ‰í† ë¦¬}/{GitHub Actionsê°€ í´ë¡ í•œ ë ˆí¬ì§€í† ë¦¬ê°€ ìœ„ì¹˜í•œ ê²½ë¡œ}/{GitHub Actions ì›Œí¬í”Œë¡œìš°ì—ì„œ ì ‘ê·¼í•˜ë ¤ëŠ” ì‹¤ì œ íŒŒì¼ ê²½ë¡œ}'
            const desktopResults = JSON.parse(fs.readFileSync('/home/runner/work/React-CI-CD/React-CI-CD/lhci_reports/desktop/manifest.json'));
            const mobileResults = JSON.parse(fs.readFileSync('/home/runner/work/React-CI-CD/React-CI-CD/lhci_reports/mobile/manifest.json'));

            // Lighthouseë¥¼ ì¸¡ì •í•œ ì‹œê°„ (Google Spreadsheet ê¸°ë¡ ìš©ë„)
            const monitoringTime = new Date().toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' });

            // PR Commentì— ì‘ì„±ë  ìƒ‰ìƒë³„ ì ìˆ˜ ê¸°ì¤€
            const scoreDescription = `> ğŸŸ¢: ${LHCI_GREEN_MIN_SCORE} - 100` + ' / ' + `ğŸŸ : ${LHCI_ORANGE_MIN_SCORE} - ${LHCI_GREEN_MIN_SCORE - 1}` + ' / ' + `ğŸ”´: ${LHCI_RED_MIN_SCORE} - ${LHCI_ORANGE_MIN_SCORE - 1}`;

            // PR Commentì— ì‘ì„±ë  comments ë³€ìˆ˜
            let comments = '';

            // commentsì— Comment ì œëª©ê³¼ ì ìˆ˜ ê¸°ì¤€ ì¶”ê°€
            comments += `## Lighthouse report âœ¨\n`;
            comments += `${scoreDescription}\n\n`;

            // Google SpreadSheetì— ê¸°ë¡ë  scores ê°ì²´
            const scores = { desktop: {}, mobile: {} };

            // Lighthouse ì¸¡ì • ê²°ê³¼ì—ì„œ ê° ì ìˆ˜ë¥¼ ì¶”ì¶œí•´ë‚´ëŠ” í•¨ìˆ˜
            const extractLhciResults = (results, device) => {
              // ì†Œì œëª©ìœ¼ë¡œ mobileì¸ì§€ desktopì¸ì§€ ì‘ì„±
              comments += `### ${device}\n\n`;

              results.forEach((result) => {
                // url, summary, jsonPath, audits ì¶”ì¶œ
                const { url, summary, jsonPath } = result;
                const { audits } = JSON.parse(fs.readFileSync(jsonPath));

                // pageUrlì—ì„œ 'http://localhost:3000' ë¶€ë¶„ ì œê±° 
                const pageUrl = url.replace('http://localhost:3000', '');
                // pageUrlì„ ì´ìš©í•´ì„œ pageName ì¶”ì¶œ
                const pageName = getLhciPageNameFromUrl(pageUrl);

                // summary ë‚´ì˜ ëª¨ë“  ì ìˆ˜ì— 100ì„ ê³±í•¨ (0-1 ì‚¬ì´ì˜ ìˆ˜ë¡œ í‘œí˜„ë˜ê¸° ë•Œë¬¸)
                Object.keys(summary).forEach((key) => (summary[key] = formatResult(summary[key])));

                // summaryì—ì„œ ì ìˆ˜ ì¶”ì¶œ
                const { performance, accessibility, 'best-practices': bestPractices, seo, pwa } = summary;
                // auditsì—ì„œ ì ìˆ˜ ì¶”ì¶œ (Performace í•˜ìœ„ ì§€í‘œë“¤)
                const { 'first-contentful-paint': firstContentfulPaint, 'largest-contentful-paint': largestContentfulPaint, 'speed-index': speedIndex, 'total-blocking-time': totalBlockingTime, 'cumulative-layout-shift': cumulativeLayoutShift } = audits;

                // PR Commentì— ì‘ì„±í•˜ê¸° ìœ„í•´ ì ìˆ˜ë¥¼ í‘œ í˜•íƒœë¡œ ìƒì„±
                const formattedScoreTable = [
                  `| Category | Score |`,
                  `| --- | --- |`,
                  `| ${getColor(performance)} Performance | ${performance} |`,
                  `| ${getColor(accessibility)} Accessibility | ${accessibility} |`,
                  `| ${getColor(bestPractices)} Best practices | ${bestPractices} |`,
                  `| ${getColor(seo)} SEO | ${seo} |`,
                  `| ${getColor(pwa)} PWA | ${pwa} |`,
                  `| ${getColor(firstContentfulPaint.score * 100)} First Contentful Paint | ${firstContentfulPaint.displayValue} |`,
                  `| ${getColor(largestContentfulPaint.score * 100)} Largest Contentful Paint | ${largestContentfulPaint.displayValue} |`,
                  `| ${getColor(speedIndex.score * 100)} Speed Index | ${speedIndex.displayValue} |`,
                  `| ${getColor(totalBlockingTime.score * 100)} Total Blocking Time | ${totalBlockingTime.displayValue} |`,
                  `| ${getColor(cumulativeLayoutShift.score * 100)} Cumulative Layout Shift | ${cumulativeLayoutShift.displayValue} |`,
                  `\n`,
                ].join('\n');

                // ì ìˆ˜ë¥¼ Google SpreadSheetì— ê¸°ë¡ë  í˜•íƒœë¡œ ì •ë¦¬í•˜ì—¬ ê°ì²´ë¡œ ìƒì„±
                const score = {
                  Performance: getAuditColorAndScore(performance),
                  Accessibility: getAuditColorAndScore(accessibility),
                  'Best Practices': getAuditColorAndScore(bestPractices),
                  SEO: getAuditColorAndScore(seo),
                  PWA: getAuditColorAndScore(pwa),
                  FCP: getPerformanceMetricColorAndScore(firstContentfulPaint),
                  LCP: getPerformanceMetricColorAndScore(largestContentfulPaint),
                  'Speed Index': getPerformanceMetricColorAndScore(speedIndex),
                  'TBT': getPerformanceMetricColorAndScore(totalBlockingTime),
                  'CLS': getPerformanceMetricColorAndScore(cumulativeLayoutShift),
                }
                
                // scores['desktop']['í˜ì´ì§€A'] í˜•íƒœë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í• ë‹¹
                scores[device][pageName] = score;

                // PR Commentì— ì‘ì„±í•  í˜•íƒœë¡œ ë§Œë“¤ì–´ commentsì— ì¶”ê°€
                // <details>ì™€ <summary> íƒœê·¸ë¥¼ ì‚¬ìš©í•´ í† ê¸€ í˜•íƒœë¡œ ìƒì„±
                comments += `<details>\n<summary>${pageName} : ${pageUrl}</summary>\n\n${formattedScoreTable}\n</details>\n\n`;
              });
            } // extractLhciResults í•¨ìˆ˜ ë 

            // desktop ì¸¡ì • ê²°ê³¼ í¬ë§·íŒ…
            extractLhciResults(desktopResults, 'desktop');
            // mobile ì¸¡ì • ê²°ê³¼ í¬ë§·íŒ…
            extractLhciResults(mobileResults, 'mobile');

            // comments, monitoringTime, scores ê°’ ë‚´ë³´ë‚´ê¸°
            core.setOutput('comments', comments);            
            core.setOutput('monitoringTime', monitoringTime);
            core.setOutput('scores', scores);

      - name: Comment PR
        uses: actions/github-script@v7
        with:
          # GITHUB_TOKENì€ GitHub Actions ì›Œí¬í”Œë¡œìš°ì—ì„œ ìë™ìœ¼ë¡œ ìƒì„±ë˜ê³  ì œê³µë˜ëŠ” ì•”í˜¸í™”ëœ í† í°
          # Actions secretsì— ìë™ìœ¼ë¡œ í¬í•¨ë˜ë¯€ë¡œ ì‚¬ìš©ìê°€ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •í•˜ì§€ ì•Šì•„ë„ ë¨
          # ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì¤‘ íŠ¹ì • ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë° í•„ìš”í•œ ê¶Œí•œì„ ì œê³µí•˜ëŠ” ë“±ì˜ ê²½ìš°ì— ì‚¬ìš©ë¨
          github-token: ${{ secrets.ACTION_TOKEN }}
          script: |
            // context ê°ì²´ëŠ” @actions/github íŒ¨í‚¤ì§€ì—ì„œ ì œê³µí•˜ëŠ” ê²ƒìœ¼ë¡œ, ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì¤‘ í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì— ëŒ€í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆìŒ
            // repoë¥¼ í†µí•´ í˜„ì¬ ë ˆí¬ì§€í† ë¦¬ì— ëŒ€í•œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
            // payloadë¥¼ í†µí•´ ì´ë²¤íŠ¸ì˜ ì•¡ì…˜, PRì— ëŒ€í•œ ì •ë³´, ì´ìŠˆì— ëŒ€í•œ ì •ë³´ ë“±ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
            const { repo, payload } = context;

            // í˜„ì¬ PRì— ë‹¬ë¦° ëª¨ë“  Comment ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜´
            const { data: previousComments } = await github.rest.issues.listComments({
              owner: repo.owner,
              repo: repo.repo,
              issue_number: payload.pull_request.number,
            });

            // PRì— ë‹¬ë¦° Comment ì¤‘ `### Lighthouse report âœ¨\n`ë¡œ ì‹œì‘í•˜ëŠ” Commentë¥¼ ì°¾ì•„ëƒ„
            // Lighthouse ì¸¡ì • ê²°ê³¼ë¥¼ ê¸°ë¡í•œ Commentë¥¼ ì°¾ì•„ë‚´ëŠ” ê²ƒ
            const previousLhciComment = previousComments.find((comment) => (comment.body.startsWith(`### Lighthouse report âœ¨\n`)));
            // Format lighthouse score ë‹¨ê³„ì—ì„œ ë‚´ë³´ëƒˆë˜ comments ê°’ì„ newComment ë³€ìˆ˜ì— í• ë‹¹
            const newComment = `${{ steps.format_lighthouse_score.outputs.comments }}`;

            // Lighthouse ì¸¡ì • ê²°ê³¼ë¥¼ ê¸°ë¡í•œ Commentê°€ ì´ë¯¸ ì¡´ì¬í•  ê²½ìš°
            if (previousLhciComment) {
              // ê¸°ì¡´ì˜ Commentë¥¼ ìˆ˜ì •
              await github.rest.issues.updateComment({
                owner: repo.owner,
                repo: repo.repo,
                comment_id: previousLhciComment.id, // ìˆ˜ì •í•  Commentì˜ id
                body: newComment, // Comment ë‚´ìš©
              });
            } else { // Lighthouse ì¸¡ì • ê²°ê³¼ë¥¼ ê¸°ë¡í•œ Commentê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš°
              // ìƒˆë¡œìš´ Comment ìƒì„±
              await github.rest.issues.createComment({
                owner: repo.owner,
                repo: repo.repo,
                issue_number: payload.pull_request.number, // Commentë¥¼ ì‘ì„±í•  PR ë²ˆí˜¸
                body: newComment,
              });
            }

      - name: Update Google SpreadSheet
        uses: actions/github-script@v7
        with:
          script: |
            // Google Spreadhsheet APIë¥¼ ì´ìš©í•˜ì—¬ Google Spreadsheetì˜ ë°ì´í„°ë¥¼ ì‰½ê²Œ ì½ê³  ì“°ê³  ìˆ˜ì •í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
            const { GoogleSpreadsheet } = require('google-spreadsheet');
            const { JWT } = require('google-auth-library');
            const { LHCI_GOOGLE_SPREAD_SHEET_ID, getLhciSheetIdFromPageName } = require('./src/configs/lighthouse/constant.js');

            const updateGoogleSheet = async () => {
              // ì„œë¹„ìŠ¤ ê³„ì •ì˜ ë¹„ê³µê°œ í‚¤ ì •ë³´ë¥¼ ë‹´ëŠ” ê°ì²´ ìƒì„±
              const creds = new JWT({
                email: `${{ secrets.GOOGLE_CLIENT_EMAIL }}`, // secretsì— ì €ì¥í•œ GOOGLE_CLIENT_EMAIL ê°’ ì‚¬ìš©
                key: `${{ secrets.GOOGLE_PRIVATE_KEY }}`, // secretsì— ì €ì¥í•œ GOOGLE_PRIVATE_KEY ê°’ ì‚¬ìš©
                scopes: ['https://www.googleapis.com/auth/spreadsheets']
              });

              // Format lighthouse score ë‹¨ê³„ì—ì„œ ë‚´ë³´ëƒˆë˜ scores ê°’ì„ desktopê³¼ mobileì— êµ¬ì¡° ë¶„í•´ í• ë‹¹
              const { desktop, mobile } = ${{ steps.format_lighthouse_score.outputs.scores }};
              // Format lighthouse score ë‹¨ê³„ì—ì„œ ë‚´ë³´ëƒˆë˜ monitoringTime ê°’ì„ monitoringTimeì— í• ë‹¹
              const monitoringTime = `${{ steps.format_lighthouse_score.outputs.monitoringTime }}`;

              const { repo, payload } = context;

              // GoogleSpreadsheet ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
              const doc = new GoogleSpreadsheet(LHCI_GOOGLE_SPREAD_SHEET_ID, creds); 

              // loadInfo ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ doc ì¸ìŠ¤í„´ìŠ¤ì— í•´ë‹¹ Spreadsheetì— ëŒ€í•œ ì •ë³´ê°€ ì±„ì›Œì§
              // Spreadsheetì˜ ë©”íƒ€ë°ì´í„° ë¡œë“œ
              await doc.loadInfo();

              for (const pageName in desktop) {
                // í˜ì´ì§€ì˜ ì‹œíŠ¸ id
                const sheetId = getLhciSheetIdFromPageName(pageName);
                // í˜ì´ì§€ì˜ desktop ì ìˆ˜
                const desktopScore = desktop[pageName];
                // í˜ì´ì§€ì˜ mobile ì ìˆ˜
                const mobileScore = mobile[pageName];

                // Spreadsheetì— ì‹œíŠ¸ idë¡œ ì ‘ê·¼
                const sheet = doc.sheetsById[sheetId];
                
                try{
                  // Spreadsheetì˜ í—¤ë” í–‰ (ì²« ë²ˆì§¸ í–‰) ë¡œë“œ
                  await sheet.loadHeaderRow();
                } catch(err) {
                  // ì—†ë‹¤ë©´ ìƒˆë¡œìš´ í–‰ ì¶”ê°€
                  await sheet.setHeaderRow(['PR url', 'Monitoring Time', ...Object.keys(desktopScore).map(key => key + ' [D]'), ...Object.keys(mobileScore).map(key => key + ' [M]')]);
                 }

                // PR url
                const prUrl = `https://github.com/${repo.owner}/${repo.repo}/pull/${payload.pull_request.number}`;
                // PR ë²ˆí˜¸ë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ PRë¡œ ë°”ë¡œ ì´ë™í•˜ë„ë¡ í•˜ì´í¼ë§í¬ë¥¼ ê±¸ì–´ë‘ 
                // '#'ì€ PR ë²ˆí˜¸ë¼ëŠ” ëŠë‚Œì„ ì£¼ê¸° ìœ„í•´ ë¶™ì„, í•„ìˆ˜ x
                const prHyperlink = '=HYPERLINK("' + prUrl + '", "#' + payload.pull_request.number + '")';

                // Spreadsheetì˜ ëª¨ë“  í–‰ì„ ê°€ì ¸ì˜´
                // ë°˜í™˜í•˜ëŠ” ê°’ì€ ê° í–‰ì„ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´ë“¤ì˜ ë°°ì—´
                const rows = await sheet.getRows(); 
                // ê°™ì€ PR ë²ˆí˜¸ë¥¼ ê°€ì§„ í–‰ì´ ìˆëŠ”ì§€ íƒìƒ‰ (í•´ë‹¹ PRì˜ ì¸¡ì • ê²°ê³¼ê°€ ì´ë¯¸ ê¸°ë¡ë˜ì–´ìˆëŠ”ì§€ í™•ì¸)
                const previousRow = rows.find((row) => row['PR url'] === `#${payload.pull_request.number}`);

                // í•´ë‹¹ PRì˜ Lighthouse ì¸¡ì • ê²°ê³¼ ê¸°ë¡ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš°
                if (previousRow) { 
                  // ê¸°ì¡´ í–‰ì˜ Monitoring Timeê³¼ PR url ì—´ì— ìƒˆë¡œìš´ ê¸°ë¡ì„ ë®ì–´ì”Œì›€
                  previousRow['Monitoring Time'] = monitoringTime;
                  previousRow['PR url'] = prHyperlink;
                  // ê¸°ì¡´ í–‰ì˜ ì ìˆ˜ ê´€ë ¨ ì—´ë“¤ì— ìƒˆë¡œìš´ ê¸°ë¡ì„ ë®ì–´ì”Œì›€
                  Object.keys(desktopScore).forEach((key) => {
                    previousRow[key + ' [D]'] = desktopScore[key];
                    previousRow[key + ' [M]'] = mobileScore[key];
                  });

                  // previousRowì˜ ë³€ê²½ì‚¬í•­ì„ ì €ì¥
                  await previousRow.save();
                  continue;
                } 

                // í•´ë‹¹ PRì˜ Lighthouse ì¸¡ì • ê²°ê³¼ ê¸°ë¡ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°
                // ìƒˆë¡œìš´ í–‰ ë°ì´í„° ìƒì„± í›„ PR urlê³¼ Monitoring Time ê°’ ì¶”ê°€
                const newRow = { 'PR url': prHyperlink, 'Monitoring Time': monitoringTime };
                // ìƒˆë¡œìš´ í–‰ ë°ì´í„°ì— ì ìˆ˜ ê´€ë ¨ ë°ì´í„° ì¶”ê°€
                Object.keys(desktopScore).forEach((key) => {
                    newRow[key + ' [D]'] = desktopScore[key];
                    newRow[key + ' [M]'] = mobileScore[key];
                  });

                // ìƒˆë¡œìš´ í–‰ì„ Spreadsheetì— ì¶”ê°€
                await sheet.addRow(newRow);
              } 
            }

            // updateGoogleSheet í•¨ìˆ˜ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ê³  ì‘ì—…ì„ ì‹¤íŒ¨ë¡œ í‘œì‹œí•¨
            updateGoogleSheet().catch(err => core.setFailed(err.message));
